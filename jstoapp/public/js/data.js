// var data = '{"id":214,"category":[{"id":"PwOwqAvkEF","name":"默认分组"}],"scenes":[{"id":"pcnUXICvsZ","project_id":214,"panorama_id":588,"group_id":88,"name":"2","thumb":{"url":"http://test.res.jsvry.com/panos/2019/08/26/5d6386aedb6ce/thumb.jpg","path":"/panos/2019/08/26/5d6386aedb6ce/thumb.jpg"},"path":"/panos/2019/08/26/5d6386aedb6ce/","domain":"//test360vrsh.360vrsh.com","scene_image":{"type":"CUBE","multires":"true","tilesize":"512","level":1},"scene_preview":{"url":"//test360vrsh.360vrsh.com/panos/2019/08/26/5d6386aedb6ce/preview.jpg","path":"/panos/2019/08/26/5d6386aedb6ce/preview.jpg"},"view":null,"hotspot":[],"effect":null,"level":[{"panorama_id":588,"url":"%s/l1/%v/l1_%s_%v_%h.jpg","w":640,"h":640}],"music":[],"mask":[],"comment":[],"category":"PwOwqAvkEF","sceneId":588},{"id":"utlUVDHsed","project_id":214,"panorama_id":549,"group_id":88,"name":"1.jpg","thumb":{"url":"http://test.res.jsvry.com/panos/2019/08/15/5d54af5d20ebf/thumb.jpg","path":"/panos/2019/08/15/5d54af5d20ebf/thumb.jpg"},"path":"/panos/2019/08/15/5d54af5d20ebf/","domain":"//test360vrsh.360vrsh.com","scene_image":{"type":"CUBE","multires":"true","tilesize":"512","level":1},"scene_preview":{"url":"//test360vrsh.360vrsh.com/panos/2019/08/15/5d54af5d20ebf/preview.jpg","path":"/panos/2019/08/15/5d54af5d20ebf/preview.jpg"},"view":null,"hotspot":[{"id":"lpakRFLzRC","url":"/image/2019/07/24/dynamics_turn_right.png","type":1,"title":"1.jpg","action":1,"ath":"36.73873666","atv":"-61.39097248","img":{"type":2,"total":24,"time":2.4,"pertime":0.1},"onclick":"loadscene(scene_358);","onloaded":"showtxt_title();hotspot_animate(128,128,0.1,24);","actionData":{"sceneId":"utlUVDHsed"},"iconType":1,"titleIsShow":true}],"level":[{"panorama_id":549,"url":"%s/l1/%v/l1_%s_%v_%h.jpg","w":256,"h":256}],"music":[],"mask":[],"comment":[],"effect":{"flakes":200,"imageurl":"/image/2019/07/24/effect_heart.png"},"category":"PwOwqAvkEF","sceneId":549}],"buttons":[{"id":"logo","container":{"width":"100","height":60,"bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"topleft","x":"10","y":"65","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":"100","height":"30","x":"0","y":"3","url":"/image/2019/07/24/icon_logo.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"logo","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"false"},"status":1},{"id":"author","container":{"width":"120","height":"20","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"topleft","x":"10","y":"10","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":36,"height":36,"x":"0","y":"3","url":"/image/2019/07/24/icon_good2.png","selectdRadio":1,"visible":"false"},"text":{"type":"text","html":"作者:","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"left","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"true"},"status":1},{"id":"pv","container":{"width":"120","height":"20","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"topleft","x":"10","y":"35","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":36,"height":36,"x":"0","y":"3","url":"/image/2019/07/24/icon_good2.png","selectdRadio":1,"visible":"false"},"text":{"type":"text","html":"浏览量:","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"left","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"true"},"status":1},{"id":"fullScreen","container":{"width":"30","height":"30","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"topright","x":"10","y":"10","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":"30","height":"30","x":"0","y":"3","url":"/image/2019/07/24/icon_full_screen.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"全屏","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"false"},"status":1},{"id":"vr","container":{"width":"30","height":"30","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"topright","x":"10","y":"50","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":"30","height":"30","x":"0","y":"3","url":"/image/2019/07/24/icon_vr.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"VR","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"false"},"status":1},{"id":"musicBg","container":{"width":"30","height":"30","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"topright","x":"10","y":"90","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":"30","height":"30","x":"0","y":"3","url":"/image/2019/07/24/icon_musicBg.png","selectdRadio":1,"visible":"true","crop":"0|0|100|100"},"text":{"type":"text","html":"背景音乐","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"false"},"status":1},{"id":"musicExplain","container":{"width":"30","height":"30","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"topright","x":"10","y":"130","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":"30","height":"30","x":"0","y":"3","url":"/image/2019/07/24/icon_musicExplain.png","selectdRadio":1,"visible":"true","crop":"0|0|100|100"},"text":{"type":"text","html":"背景解说","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"false"},"status":1},{"id":"cruise","container":{"width":"30","height":"30","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"topright","x":"10","y":"170","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":"30","height":"30","x":"0","y":"3","url":"/image/2019/07/24/icon_cruise.png","selectdRadio":1,"visible":"true","crop":"0|0|100|100"},"text":{"type":"text","html":"自动巡游","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"false"},"status":1},{"id":"sandTable","container":{"width":"30","height":"30","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"topright","x":"10","y":"210","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":"30","height":"30","x":"0","y":"3","url":"/image/2019/07/24/icon_sandTable.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"沙盘","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"false"},"status":1},{"id":"comment","container":{"width":"40","height":"60","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"bottomright","x":"10","y":"190","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":36,"height":36,"x":"0","y":"3","url":"/image/2019/07/24/icon_comment.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"说一说","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"true"},"status":1},{"id":"fabulous","container":{"width":"40","height":"60","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"bottomright","x":"10","y":"130","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":36,"height":36,"x":"0","y":"3","url":"/image/2019/07/24/icon_good1.png","selectdRadio":1,"visible":"true","crop":"0|0|100|100"},"text":{"type":"text","html":"点赞","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"true"},"status":1},{"id":"share","container":{"width":"40","height":"60","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"bottomright","x":"10","y":"70","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":36,"height":36,"x":"0","y":"3","url":"/image/2019/07/24/icon_share.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"分享","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"true"},"status":1},{"id":"introduce","container":{"width":"40","height":"60","bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"bottomright","x":"10","y":"10","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":36,"height":36,"x":"0","y":"3","url":"/image/2019/07/24/icon_introduce.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"介绍","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"true"},"status":1},{"id":"selectScene","container":{"width":60,"height":60,"bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"bottomleft","x":"10","y":"10","bgroundedge":"3","visible":"true"},"icon":{"align":"top","edge":"top","width":36,"height":36,"x":"0","y":"3","url":"/image/2019/07/24/icon_scene.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"选择场景","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"true"},"status":1},{"id":"link","container":{"width":60,"height":60,"bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"bottomleft","x":"70","y":"10","bgroundedge":"3","visible":"true","link":"","openMode":"_blank"},"icon":{"align":"top","edge":"top","width":36,"height":36,"x":"0","y":"3","url":"/image/2019/07/24/icon_link.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"外部链接","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"true"},"status":2},{"id":"tel","container":{"width":60,"height":60,"bgcolor":"#000000","bgalpha":"0","bgcapture":"true","keep":"true","type":"container","align":"bottomleft","x":"130","y":"10","bgroundedge":"3","visible":"true","phone":""},"icon":{"align":"top","edge":"top","width":36,"height":36,"x":"0","y":"3","url":"/image/2019/07/24/icon_phone.png","selectdRadio":1,"visible":"true"},"text":{"type":"text","html":"预约电话","align":"bottom","width":"100%","y":"0","x":"0","background":"false","border":"false","css":{"fontFamily":"微软雅黑","fontSize":"12px","color":"#ffffff","fontWeight":"normal","fontStyle":"none","textDecoration":"none","textAlign":"center","lineHeight":"16px","textIndent":"0px","letterSpacing":"0px","textShadow":"1px 1px 2px #000"},"visible":"true"},"status":2}],"sandTable":{},"info":{"id":214,"name":"asdf","thumb":{"url":"http://test.res.jsvry.com/panos/2019/08/26/5d6386aedb6ce/thumb.jpg","path":"/panos/2019/08/26/5d6386aedb6ce/thumb.jpg"},"labels":["秋季"],"description":"","classify_id":2,"good":0,"view":3,"public_status":1,"is_vip":1}}';

//APP传过来data并进行保存操作
dsBridge.register('getData', function (data) {

    initialData(data);
    return {errcode: 0, errmsg: "设置成功"};
});

/**
 *初始化场景数据存入local storage
 *
 *判断local storage里是存在数据，如果有不再保存
**/
function initialData(re){
    if (getLS('global_data') == null) {
        saveLocalStorage(re);
    }else{

    }
}
// initialData(data)

/**
 *保存修改后的数据到local storage
 *
 *所有操作local storage的数据，都触发他来保存
**/
function saveLocalStorage(obj){
    setLS("global_data", obj);
}

//保存修改后的view
function saveView(viewData){
    currentScene.view = viewData;               //把修改的数据放入当前场景对应的键里面

    saveLocalStorage(JSON.stringify(localStorageData));         //保存到localstorage
}

//保存特效
function saveEffect(effectData){
    currentScene.effect = effectData;               //把修改的数据放入当前场景对应的键里面

    saveLocalStorage(JSON.stringify(localStorageData));         //保存到localstorage
}

//添加热点时保存
function saveHotspot(hotspotData){
    var newArr = [];
    if (currentScene.hotspot.length != 0) {
        currentScene.hotspot.forEach(item=>{
            if(item.id != hotspotData.id){
                newArr.push(item);
            }
        });
    }
    newArr.push(hotspotData);
    currentScene.hotspot = newArr;

    saveLocalStorage(JSON.stringify(localStorageData));         //保存到localstorage
}

//保存删除后台的hotspot{}
function saveDelHotspot(id){
    var newDelArr = [];
    if (currentScene.hotspot.length != 0) {
        currentScene.hotspot.forEach(item=>{
            if(item.id != id){
                newDelArr.push(item);
            }
        });
    }
    currentScene.hotspot = newDelArr;

    saveLocalStorage(JSON.stringify(localStorageData));         //保存到localstorage
}

//修改当前操作的热点 data={id:value,key:value}
function saveEditHotspot(data){
    var newEditArr = [];
    if (currentScene.hotspot.length != 0) {
        currentScene.hotspot.forEach(item=>{
            if(item.id != data.id){
                newEditArr.push(item);
            }else{
                for(j in data){
                    if (j != 'id') {
                        item[j] = data[j];
                    }
                }
                newEditArr.push(item);
            }
        });
    }
    currentScene.hotspot = newEditArr;

    saveLocalStorage(JSON.stringify(localStorageData));         //保存到localstorage
}

//保存背景音乐
function saveMusic(url,title){
    var musicBg = getMusicBg(url,title);
    var newMusic = {
        musicBg: musicBg
    };

    scenes.forEach(item=>{
        item.music = newMusic;
    })

    saveLocalStorage(JSON.stringify(localStorageData));         //保存到localstorage
}

//保存info信息
function saveInfo(){
    var jsonObj = JSON.parse('{"name":"9834275345","labels":["秋季"],"description":"","classify_id":2,"public_status":1}');
    var info = localStorageData.info;
    for(q in jsonObj){
        info[q] = jsonObj[q];
    }

    localStorageData.info = info;
    saveLocalStorage(JSON.stringify(localStorageData));         //保存到localstorage
}






